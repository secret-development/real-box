<table class="table table-striped table-condensed transactions">
  <thead>
    <tr>
      <th><%= sortable "id", "#" %></th>
      <th><%= sortable "name", "Сделка" %></th>
      <th>Тип сделки</th>
      <th><%= sortable "user_id", "Ответственный" %></th>
      <th><%= sortable "customer_id", "Клиент" %></th>
      <th><%= sortable "created_at", "Дата" %></th>
      <th>Объект сделки</th>
      <th><%= sortable "price", "Сумма" %></th>
      <th>Оплата</th>
      <th>Операции</th>
    </tr>
  </thead>
  <tbody>
    <% @transactions.each do |t| %>
      <tr>
        <% if current_user.role? %>
          <td><%= t.id %></td>
          <td><%= t.name %></td>
          <td><%= t.typetransaction.name %></td>
          <td><%= link_to t.user.lastname, user_path(t.user) %></td>
          <td><%= link_to t.customer.lastname, customer_path(t.customer) %></td>
          <td><%= to_formatted_date(t.created_at) %></td>
          <td>
            <% if t.subject_id == nil %>
              Отсутствует
            <% else %>
              <%= t.subject.address %>
            <% end %>
          </td>
          <td><%= price_currency(t) %></td>
          <td>
            <% if t.payment == true %>
              <%= link_to edit_icon + ' ' + t.payment_value, 
                  transaction_path(t, 
                  :transaction => {:payment => false}),
                  :method => :put, :confirm => "Вы уверены?", 
                  :title => "Изменить" %>
            <% else  %>
              <%= link_to edit_icon + ' ' + t.payment_value, 
                  transaction_path(t, 
                  :transaction => {:payment => true}),
                  :method => :put, :confirm => "Вы уверены?", 
                  :title => "Изменить" %>
            <% end %>
        </td>
        <td class="actions-buttons">
          <%= link_to eye_icon, transaction_path(t), :title => "Просмотр" %>
          <%= link_to edit_icon, edit_transaction_path(t), 
              :title => "Редактировать" %>
          <%= link_to delete_icon, t, :method => :delete,
                      :confirm => "Вы уверены?" %>
        </td>
        <% elsif t.user_id == current_user.id %>
          <td><%= t.id %></td>
          <td><%= t.name %></td>
          <td><%= t.typetransaction.name %></td>
          <td><%= link_to t.user.lastname, user_path(t.user) %></td>
          <td><%= link_to t.customer.lastname, customer_path(t.customer) %></td>
          <td><%= to_formatted_date(t.created_at) %></td>
          <td>
            <% if t.subject_id == nil %>
              Отсутствует
            <% else %>
              <%= t.subject.address %>
            <% end %>
          </td>
          <td><%= to_dollar(t) %></td>
          <td>
            <% if t.payment == true %>
              <%= link_to edit_icon + ' ' + t.payment_value, 
                  transaction_path(t, 
                  :transaction => {:payment => false}),
                  :method => :put, :confirm => "Вы уверены?", 
                  :title => "Изменить" %>
            <% else  %>
              <%= link_to edit_icon + ' ' + t.payment_value, 
                  transaction_path(t, 
                  :transaction => {:payment => true}),
                  :method => :put, :confirm => "Вы уверены?", 
                  :title => "Изменить" %>
            <% end %>
          </td>
          <td class="actions-buttons">
            <%= link_to eye_icon, transaction_path(t) %>
            <% if can? :update, t %>
              <%= link_to edit_icon, edit_transaction_path(t) %>
            <% end %>
            <% if can? :destroy, t %>
              <%= link_to delete_icon, t, :method => :delete,
                          :confirm => "Вы уверены?" %>
            <% end %>
          </td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>
<%= paginate @transactions %>