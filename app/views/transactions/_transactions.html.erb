<table class="table table-striped table-condensed transactions">
  <thead>
    <tr>
      <th><%= sortable "id", "#" %></th>
      <th><%= sortable "name", "Сделка" %></th>
      <th>Тип сделки</th>
      <th><%= sortable "user_id", "Ответственный" %></th>
      <th><%= sortable "customer_id", "Клиент" %></th>
      <th><%= sortable "created_at", "Дата" %></th>
      <th>Объект сделки</th>
      <th><%= sortable "price", "Сумма" %></th>
      <th>Оплата</th>
      <th>Операции</th>
    </tr>
  </thead>
  <tbody>
    <% @transactions.each do |t| %>
      <tr>
        <td><%= t.id %></td>
        <td><%= t.name %></td>
        <td><%= t.typetransaction.name %></td>
        <td>
          <%= link_to t.user.email, user_path(t.user) %>
        </td>
        <td>
          <%= link_to t.customer.lastname, customer_path(t.customer) %>
        </td>
        <td><%= to_formatted_date(t.created_at) %></td>
        <td>
          <% if t.subject == nil %>
            Отсутствует
          <% else %>
            <%= link_to t.subject.address, subject_path(t.subject) %>
          <% end %>
        </td>
        <td><%= to_dollar(t.price) %></td>
        <td>
          <% if t.user.id == current_user.id %> 
            <% if t.payment == true %>
              <%= link_to edit_icon + ' ' + t.payment_value, 
                  transaction_path(t, 
                  :transaction => {:payment => false}),
                  :method => :put, :confirm => "Вы уверены?", 
                  :title => "Изменить" %>
            <% else  %>
              <%= link_to edit_icon + ' ' + t.payment_value, 
                  transaction_path(t, 
                  :transaction => {:payment => true}),
                  :method => :put, :confirm => "Вы уверены?", 
                  :title => "Изменить" %>
            <% end %>
          <% else %>
            <%= t.payment_value %>
          <% end %>
        </td>
        <td>
          <%= link_to eye_icon, transaction_path(t), :title => "Просмотр" %>
          <%= link_to edit_icon, edit_transaction_path(t), 
              :title => "Редактировать" %>
          <%= link_to delete_icon, t, :method => :delete,
                      :confirm => "Вы уверены?" %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
<%= paginate @transactions %>